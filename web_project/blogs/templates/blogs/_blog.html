{% load static %}

{# JS #}
<script type="text/javascript">

  function yay(event){
    id={{blog.id}}
    console.log("yayed "+id);
    $.ajax({
        url:'{% url "blogs:yay" pk=blog.id%}',
        datatype : "json",
        success : function(data){
          $(event.target).css("color","orange")
          $(event.target).unbind("click")
          $(event.target).click(unyay)
          console.log(event.target)
          $("#{{blog.id}}_points").text(data.points)
        },
    })
  }

  function unyay(event){

    id={{blog.id}}
    console.log("unyayed "+id);
    $.ajax({
        url:'{% url "blogs:unyay" pk=blog.id%}',
        datatype : "json",
        success : function(data){
          $(event.target).css("color","black")
          $(event.target).unbind("click")
          $(event.target).click(yay)
          console.log(event.target)
          $("#{{blog.id}}_points").text(data.points)

        },
    })
  }

  function nay(event){
    id={{blog.id}}
    console.log("nayed "+id);
    $.ajax({
        url:'{% url "blogs:nay" pk=blog.id %}',
        datatype : "json",
        complete : function(data){
          console.log("in");
          $(event.target).css("color","blue")
          $(event.target).unbind("click")
          $(event.target).click(unnay)
          console.log(event.target)
          console.log(data.points)
          $("#{{blog.id}}_points").text(data.points)
          $("#{{blog.id}}_points").text(data.points)

        },
    })
  }

  function unnay(event){
    id={{blog.id}}
    console.log("unnayed "+id);
    $.ajax({
        url:'{% url "blogs:unnay" pk=blog.id %}',
        datatype : "json",
        success : function(data){
          $(event.target).css("color","black")
          $(event.target).unbind("click")
          $(event.target).click(nay)
          console.log(event.target)
          $("#{{blog.id}}_points").text(data.points)


        },
    })
  }


</script>


{# AJAX #}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<div class="post-card card ">
  <div class="card-body">
  <a href="{% url 'categotries:category_blogs' name=blog.category.name %}">
    {% if blog.author.uer.profile_pic %}
    <img class="writer"src="{{blog.author.uer.profile_pic.url}}" alt="">
    {% else %}
    <img class="writer" src="{% static "css/uicon.png" %}" alt="">
    {% endif %}
    {{blog.category.name}}
  </a>
  <span class="postedby">
    Posted by u/{{blog.author.username}} {{blog.time_written|timesince}}
  </span>
  <span style="float:right;font-size:1.4em;">

    <i  class="fas fa-grin-hearts" id="{{blog.id}}_yay"></i>

    {% if blog.id in yayed_blogs %}
    <script type="text/javascript">
      console.log("in first block");
      $("#{{blog.id}}_yay").css("color",'orange')
      $("#{{blog.id}}_yay").click(unyay)
    </script>
    {% else %}
    <script type="text/javascript">
      $("#{{blog.id}}_yay").css("color",'black')
      $("#{{blog.id}}_yay").click(yay)
    </script>
    {% endif %}

    <span id="{{blog.id}}_points">{{blog.points}}</span>

     <i class="fas fa-sad-cry" id="{{blog.id}}_nay"></i>

     {% if blog.id in nayed_blogs %}
     <script type="text/javascript">
       $("#{{blog.id}}_nay").css("color","blue")
       $("#{{blog.id}}_nay").click(unnay)
     </script>
     {% else %}
     <script type="text/javascript">
       $("#{{blog.id}}_nay").css("color","black")
       $("#{{blog.id}}_nay").click(nay)
     </script>
     {% endif %}

  </span>

  <h5>{{blog.title}}</h5>
  <br>
  <p>{{blog.content|safe|truncatechars_html:450}}</p>
  <a href="{% url 'blogs:details' pk=blog.pk %}" class="btn  btn-outline-secondary">see more</a>

  <span class="images">
    {% if blog.blog_images.count < 4 %}
    {% for image in blog.blog_images.all %}
    <img class="post-images"src="{{image.img.url}}" alt="no image">
    {% endfor %}
    {% else %}
    {% for image in blog.blog_images.all|slice:':3' %}
    <img class="post-images"src="{{image.img.url}}" alt="no image">
    {% endfor %}
    <img class="post-images" src="" alt="">
    {% endif %}


  </span>
  </div>
</div>
